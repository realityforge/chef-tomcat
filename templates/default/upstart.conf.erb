#
# Generated by Chef
#
# tomcat - Tomcat Server
#
description     "Tomcat Application Server - <%= @resource.instance_name %> Instance"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

# Increase default timeout before killing (on stop) to 10 seconds
kill timeout 50

setuid <%= @resource.system_user %>
setgid <%= @resource.system_group %>
respawn limit 15 5
kill signal HUP
umask 0077

<% config_dir = "#{node['tomcat']['instances_dir']}/#{@resource.instance_name}/conf" %>
pre-start script
  test -f <%= node['tomcat']['base_dir'] %>/bin/bootstrap.jar || { stop; exit 0; }
  test -d <%= config_dir %> || { stop; exit 0; }
end script

<% @resource.env_variables.sort.each do |key, value| -%>
env <% key %>=<% value %>
<% end %>

chdir <%= config_dir %>
exec <%= @authbind ? "/usr/bin/authbind --deep " : "" %><%= node["java"]["java_home"] %>/bin/java <%= @args.join(' ') %>
